jQuery(function(){if(typeof msmartSearchParams=="undefined"){return}var b=msmartSearchParams.lf,a={},l=$('<a class="mss-button-more" href="#">'),f=null,d=null,k={},i,g=b.mode||"standard";if(typeof MSS_MODE!="undefined"){g=MSS_MODE}if(b.enabled!="1"&&(g=="tabs"||b.enabled_categories!="1")){return}function h(){if(b.history_enabled!="1"){return}$.get($("base").attr("href")+"index.php?route=extension/module/msmart_search/savephrase&phrase="+encodeURIComponent(i))}function e(m){var n=$("base").attr("href")+"index.php?route=product/search";if(m!==""){n+="&search="+encodeURIComponent(m)}if(b.search_in_product_descriptions=="1"){n+="&description=1"}return n}function c(t){var p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o,n,m,x,w,v,u,y,s=0,z=0,q="",r=[];if(!t){return t}t+="";do{x=p.indexOf(t.charAt(s++));w=p.indexOf(t.charAt(s++));v=p.indexOf(t.charAt(s++));u=p.indexOf(t.charAt(s++));y=x<<18|w<<12|v<<6|u;o=y>>16&255;n=y>>8&255;m=y&255;if(v==64){r[z++]=String.fromCharCode(o)}else{if(u==64){r[z++]=String.fromCharCode(o,n)}else{r[z++]=String.fromCharCode(o,n,m)}}}while(s<t.length);q=r.join("");return q.replace(/\0+$/,"")}var j=$(b.input_selector).typeahead({hint:true,highlight:true,minLength:typeof b.min_length=="undefined"?1:parseInt(b.min_length),classNames:{wrapper:"msmart-search-live-filter mslf-mode-"+g+(typeof MSS_LANG_DIRECTION!="undefined"?" msmart-search-language-direction-"+MSS_LANG_DIRECTION:"")}},{name:"name",displayKey:"name",valueKey:"id",source:new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:jQuery("base").attr("href")+"index.php?route=extension/module/msmart_search/autocomplete&phrase=%QUERY",wildcard:"%QUERY",rateLimitWait:500,cache:g=="tabs"?false:true,prepare:function(n,m){m.dataType="text";m.url=m.url.replace("%QUERY",n);k={};j.closest(".msmart-search-live-filter").find(".tt-input").trigger("change.shva");return m},transform:function(m){var o=$("<tmp>").html(m),n=JSON.parse(c(o.find("#mss-response").html()));a=n.lang;l.html(a.text_button_view_all);return n.results}}}),templates:{suggestion:function(o){var m="",n="";if(g=="standard"){if(o.img){m+='<td width="'+o.img_w+'"><img src="'+o.img+'" width="'+o.img_w+'" height="'+o.img_h+'" alt="" /></td>'}m+="<td>";m+=o.name;m+='<div class="clearfix"></div>';if(o.description){m+="<small>"+o.description+"</small>";m+='<div class="clearfix"></div>'}if(o.manufacturer){m+='<small class="pull-left">'+o.manufacturer+"</small>"}if(o.model){m+='<small class="pull-right">'+o.model+"</small>"}m+="</td>";if(o.price){m+='<td class="mslf-price" width="1%">';if(o.special){m+=o.special;m+="<br />";m+="<strike>"}m+=o.price;if(o.special){m+="</strike>"}m+="</td>"}return'<div data-type="'+o.type+'"><table><tr>'+m+"</tr></table></div>"}m+='<div class="mssl-product-item-list col-xs-'+(12/parseInt(b.product_columns))+'">';m+='<a href="'+o.url+'">';m+='<img src="'+o.img+'" width="'+o.img_w+'" height="'+o.img_h+'" alt="" />';m+='<span class="inline-block product-name">'+o.name+"</span>";if(o.price){m+='<span class="product-price">';m+=o.special?"<strike>":"";m+=o.price;m+=o.special?"</strike>":"";m+="</span>";if(o.special){m+='<span class="product-special-price">'+o.special+"</span>"}}m+="</a>";m+="</div>";n='<div class="'+(typeof k[o.extra_phrase||""]=="undefined"?"":"hide")+'" data-type="'+o.type+'" data-extra-phrase="'+(o.extra_phrase||"").replace(/"/g,"&quot;")+'">';n+=(o.extra_phrase||i)+'<div class="hide">'+m+"</div>";n+="</div>";k[o.extra_phrase||""]=true;return n}},limit:b.limit*10}).on("keydown",function(m){if(m.keyCode==13){jQuery(this).parent().parent().find("button").trigger("click")}}).on("keyup",function(){var m=$(this);i=m.val();if(i==""&&b.show_loading_icon){m.parent().find(".mslf-loading").remove()}}).bind("typeahead:select",function(n,m){h();setTimeout(function(){if(g=="tabs"){document.location=e(m.extra_phrase||i)}else{document.location=m.url.replace(/&amp;/g,"&")}},300);if(g=="tabs"){setInterval(function(){j.closest(".msmart-search-live-filter").find(".tt-input").val("")},10)}}).bind("typeahead:asyncrequest",function(){if(b.show_loading_icon){if(!$(this).parent().find(".mslf-loading").length){$(this).parent().prepend('<div class="mslf-loading"></div>')}}}).bind("typeahead:asyncreceive",function(m){var n=$(this);if(b.show_loading_icon){n.parent().find(".mslf-loading").remove()}setTimeout(function(){n.parent().find(".tt-menu").each(function(){if(!$(this).is(":visible")&&$(this).find(".tt-suggestion").length){$(this).css("display","block")}})},50);if(d&&b.enabled_categories=="1"){d.html("")}if(g=="standard"&&(b.enabled_categories=="1"||b.show_header||b.show_button_view_all=="1")){setTimeout(function(){var p=f.find("[data-type=product]").length,o=f.find("[data-type=category]").length;if(b.show_header){$(b.input_selector).parent().find(".mss-header-products")[p?"removeClass":"addClass"]("hide").text(a.text_products)}if(b.show_header_categories){$(b.input_selector).parent().find(".mss-header-categories")[o?"removeClass":"addClass"]("hide").text(a.text_categories)}if(o){f.find("[data-type=category]").each(function(){d.append($(this))})}f[p?"removeClass":"addClass"]("hide");if(b.show_button_view_all=="1"){l[p?"removeClass":"addClass"]("hide")}if(b.enabled_categories=="1"){d[o?"removeClass":"addClass"]("hide")}},10)}else{if(g=="tabs"){setTimeout(function(){f=$('<div class="mslf-product-list" style="height:'+(b.max_height_tabs||430)+'px">');$(b.input_selector).parent().find(".tt-dataset > div").mouseover(function(){var o=$(this).attr("data-extra-phrase")||"";f.html("");if(b.show_header){f.html("<h3>"+a.text_top_results+' "'+(o||i)+'"</h3>')}$(b.input_selector).parent().find(".tt-dataset > [data-extra-phrase] > div").each(function(){if($(this).parent().attr("data-extra-phrase")==o){f.append($(this).html())}})});$(b.input_selector).parent().find(".tt-dataset > div:first").trigger("mouseover");$(b.input_selector).parent().find(".tt-dataset").append(f)},10)}}});j.parent().find(".tt-dataset").css(g=="tabs"?"height":"max-height",(g=="standard"?b.max_height:b.max_height_tabs||430)+"px");if(g=="standard"){f=$(b.input_selector).parent().find(".tt-dataset").addClass("tt-dataset-products");if(b.enabled!="1"){f.addClass("hide")}else{if(b.show_header){f.before('<h3 class="mss-header mss-header-products">')}}if(b.enabled_categories=="1"){d=f.clone().addClass("tt-dataset-categories").removeClass("tt-dataset-products hide");if(b.display_categories_first=="1"){d.prependTo(f.parent())}else{d.appendTo(f.parent())}if(b.show_header_categories){d.before('<h3 class="mss-header mss-header-categories">')}}if(b.show_button_view_all=="1"){l.appendTo($(b.input_selector).parent().find(".tt-menu")).attr("href",e(j.closest(".msmart-search-live-filter").find(".tt-input").val()));j.closest(".msmart-search-live-filter").find(".tt-input").bind("keyup change.shva",function(){l.attr("href",e($(this).val()))})}}i=$(".msmart-search-live-filter .tt-input").val();$(".msmart-search-live-filter").click(function(m){m.stopPropagation()});$("#search").find("button").off("click").on("click",function(){location=e($("header #search input[name=search]").val())});$("#search input[name=search]").on("keydown",function(m){if(m.keyCode==13){$("header #search").find("button").trigger("click")}})});